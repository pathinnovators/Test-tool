<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live AI Transcription Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #ffffff;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }

  h1 {
    text-align: center;
  }

  button {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    margin-top: 10px;
    color: #fff;
  }

  .start { background: #22c55e; }
  .stop  { background: #ef4444; }
  .save  { background: #3b82f6; }

  .status {
    text-align: center;
    margin-top: 10px;
    color: #22c55e;
  }

  .box {
    margin-top: 20px;
    padding: 15px;
    border-radius: 12px;
    background: #1e293b;
    min-height: 120px;
    line-height: 1.6;
    white-space: pre-wrap;
  }

  .title {
    font-weight: bold;
    margin-bottom: 6px;
    color: #93c5fd;
  }
</style>
</head>

<body>

<h1>üé§ Live AI Transcription Assistant</h1>

<button class="start" onclick="startListening()">Start</button>
<button class="stop" onclick="stopListening()">Stop</button>
<button class="save" onclick="saveTranscript()">Save Transcript</button>

<div class="status" id="status">Idle</div>

<div class="box">
  <div class="title">Live Transcription</div>
  <div id="liveText">Waiting for speech‚Ä¶</div>
</div>

<div class="box">
  <div class="title">AI Answer (Live)</div>
  <div id="answerText">Waiting for question‚Ä¶</div>
</div>

<script>
/* =========================
   SPEECH RECOGNITION
========================= */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  alert("Speech Recognition not supported. Use Google Chrome.");
}

const recognition = new SpeechRecognition();
recognition.lang = "en-US";
recognition.continuous = true;
recognition.interimResults = true;

const liveText   = document.getElementById("liveText");
const answerText = document.getElementById("answerText");
const statusText = document.getElementById("status");

let finalTranscript = "";
let pauseTimer = null;

/* START */
function startListening() {
  finalTranscript = "";
  liveText.innerText = "";
  answerText.innerText = "";
  statusText.innerText = "üéôÔ∏è Listening...";
  recognition.start();
}

/* STOP */
function stopListening() {
  recognition.stop();
  statusText.innerText = "‚èπÔ∏è Stopped";
}

/* LIVE TRANSCRIPTION */
recognition.onresult = (event) => {
  let interimText = "";

  for (let i = event.resultIndex; i < event.results.length; i++) {
    const text = event.results[i][0].transcript;

    if (event.results[i].isFinal) {
      finalTranscript += text + " ";
    } else {
      interimText += text;
    }
  }

  // TRUE live transcription
  liveText.innerText = finalTranscript + interimText;

  // detect pause ‚Üí send to AI
  clearTimeout(pauseTimer);
  pauseTimer = setTimeout(() => {
    recognition.stop();
    sendToAI(finalTranscript.trim());
  }, 900); // FAST pause detection
};

/* =========================
   AI STREAMING RESPONSE
========================= */
async function sendToAI(question) {
  if (!question) return;

  statusText.innerText = "‚ö° AI responding...";
  answerText.innerText = "";

  try {
    const response = await fetch("https://YOUR_API_URL/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question })
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let output = "";

    while (true) {
      const { value, done } = await reader.read();
      if (done) break;

      output += decoder.decode(value);
      answerText.innerText = output; // ULTRA-FAST STREAMING
    }

    statusText.innerText = "‚úÖ Done";
    speak(output);

  } catch (e) {
    answerText.innerText = "AI connection failed.";
    statusText.innerText = "‚ùå Error";
  }
}

/* =========================
   TEXT TO SPEECH
========================= */
function speak(text) {
  if (!window.speechSynthesis) return;
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-US";
  window.speechSynthesis.speak(msg);
}

/* =========================
   SAVE TRANSCRIPT
========================= */
function saveTranscript() {
  if (!finalTranscript.trim()) {
    alert("No transcript available.");
    return;
  }

  const content =
`TRANSCRIPT
--------------------
${finalTranscript}

AI ANSWER
--------------------
${answerText.innerText}
`;

  const blob = new Blob([content], { type: "text/plain" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "live_ai_transcript.txt";
  link.click();
}
</script>

</body>
</html>
