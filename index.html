<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live AI Voice Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }

  h1 {
    text-align: center;
    margin-bottom: 15px;
  }

  button {
    width: 100%;
    padding: 15px;
    font-size: 18px;
    background: #22c55e;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    color: white;
  }

  button.stop {
    background: #ef4444;
    margin-top: 10px;
  }

  .status {
    text-align: center;
    margin-top: 10px;
    color: #22c55e;
  }

  .box {
    margin-top: 20px;
    padding: 15px;
    border-radius: 12px;
    background: #1e293b;
    min-height: 80px;
    line-height: 1.6;
    white-space: pre-wrap;
  }

  .title {
    font-weight: bold;
    margin-bottom: 8px;
    color: #93c5fd;
  }
</style>
</head>

<body>

<h1>üé§ Live AI Voice Assistant</h1>

<button onclick="startListening()">Start Live Transcription</button>
<button class="stop" onclick="stopListening()">Stop</button>

<div class="status" id="status">Idle</div>

<div class="box">
  <div class="title">Live Transcription</div>
  <div id="liveText">Start speaking...</div>
</div>

<div class="box">
  <div class="title">Live AI Answer</div>
  <div id="answerText">AI will respond here...</div>
</div>

<script>
const liveText = document.getElementById("liveText");
const answerText = document.getElementById("answerText");
const statusText = document.getElementById("status");

const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  alert("Speech Recognition not supported. Please use Google Chrome.");
}

const recognition = new SpeechRecognition();
recognition.lang = "en-US";
recognition.continuous = true;
recognition.interimResults = true;

let finalTranscript = "";
let silenceTimer = null;

function startListening() {
  finalTranscript = "";
  liveText.innerText = "";
  answerText.innerText = "";
  statusText.innerText = "üéôÔ∏è Listening...";
  recognition.start();
}

function stopListening() {
  recognition.stop();
  statusText.innerText = "‚èπÔ∏è Stopped";
}

recognition.onresult = (event) => {
  let interim = "";

  for (let i = event.resultIndex; i < event.results.length; i++) {
    const text = event.results[i][0].transcript;
    if (event.results[i].isFinal) {
      finalTranscript += text + " ";
    } else {
      interim += text;
    }
  }

  liveText.innerText = finalTranscript + interim;

  // reset silence timer
  clearTimeout(silenceTimer);
  silenceTimer = setTimeout(() => {
    recognition.stop();
    sendToAI(finalTranscript.trim());
  }, 1200); // auto-send after pause
};

recognition.onend = () => {
  statusText.innerText = "‚ö° Processing...";
};

async function sendToAI(question) {
  if (!question) return;

  answerText.innerText = "";
  statusText.innerText = "ü§ñ AI Thinking...";

  try {
    const response = await fetch("https://YOUR_API_URL/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question })
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let aiText = "";

    while (true) {
      const { value, done } = await reader.read();
      if (done) break;

      const chunk = decoder.decode(value);
      aiText += chunk;
      answerText.innerText = aiText;
    }

    statusText.innerText = "‚úÖ Answer Ready";
    speak(aiText);

  } catch (err) {
    answerText.innerText = "Error connecting to AI.";
    statusText.innerText = "‚ùå Error";
  }
}

function speak(text) {
  if (!window.speechSynthesis) return;
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-US";
  window.speechSynthesis.speak(msg);
}
</script>

</body>
</html>
